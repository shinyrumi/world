<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>국가 부서 선택 가이드 (실시간 참여)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Extended Warm Neutrals with Professional Blue and Green Accents -->
    <!-- Application Structure Plan: A dynamic, single-page application for students to sign up for government departments. The layout uses a responsive grid of interactive cards. Each card displays department info and now includes a real-time list of members and a sign-up form. This structure facilitates a collaborative and transparent selection process, allowing students to see department popularity in real-time. -->
    <!-- Visualization & Content Choices: Report Info (Department roles) -> Goal (Enable collaborative sign-up) -> Viz/Presentation (Interactive cards with input forms and real-time member lists) -> Interaction (Enter name, click to join, see live updates) -> Justification (This interactive approach is more engaging and functional for a group activity than a static guide, promoting self-organization.) -> Library/Method (Tailwind CSS for styling, Firebase/Firestore for real-time database, Vanilla JS for logic). -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f9fafb;
            color: #1f2937;
        }
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        .department-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .department-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .card-content {
            flex-grow: 1;
        }
        .member-list {
            min-height: 50px;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <header class="text-center my-8 md:my-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 tracking-tight">우리 국가의 미래를 설계할 부서를 선택하세요</h1>
            <p class="text-lg text-gray-500 mt-4 max-w-3xl mx-auto">각 부서는 '멋진 신세계'의 문제점을 해결하고, 우리의 가치를 실현하는 중요한 역할을 합니다.<br>이름을 입력하고 원하는 부서에 가입하여 국가 건설에 참여해 보세요!</p>
        </header>

        <main>
            <div id="department-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Department cards will be dynamically inserted here -->
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, doc, onSnapshot, updateDoc, arrayUnion, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const departments = [
            { id: 'admin_legislative', name: '행정입법부', icon: '🏛️', color: 'blue-500', category: '핵심', description: '국가의 큰 방향을 결정하고, 헌법과 법률을 만듭니다.', activity: '정부 형태 결정, 헌법 제정, 법률안 발의', connection: '독재가 아닌 민주적 의사결정 구조 설계', tags: ['#정치', '#사회', '#리더십'] },
            { id: 'economy_planning', name: '경제기획부', icon: '💹', color: 'green-500', category: '핵심', description: '경제 시스템을 설계하고 국가의 예산을 관리합니다.', activity: '화폐 발행, 세금 정책 수립, 산업 육성', connection: '획일화된 소비 사회를 넘어선 대안 경제 모색', tags: ['#경제', '#경영', '#금융'] },
            { id: 'education_welfare', name: '교육복지부', icon: '❤️', color: 'red-500', category: '핵심', description: '국민의 성장과 행복, 건강한 삶을 책임집니다.', activity: '미래 교육 과정 설계, 복지 제도 구축', connection: "'소마'와 조건화 교육을 대체할 인간적인 대안 제시", tags: ['#교육', '#복지', '#심리'] },
            { id: 'justice', name: '법무부', icon: '⚖️', color: 'purple-500', category: '특화', description: '정의를 실현하고 사회 질서를 유지합니다.', activity: '재판 제도 설계, 교정 시설 운영 방안 구상', career: '판사, 검사, 변호사, 경찰' },
            { id: 'science_tech', name: '과학기술부', icon: '🔬', color: 'yellow-500', category: '특화', description: '미래 기술을 연구하고 윤리 기준을 만듭니다.', activity: 'AI 윤리 강령 제정, 우주 탐사 계획 수립', career: '과학자, 연구원, IT 개발자' },
            { id: 'culture_arts', name: '문화예술부', icon: '🎨', color: 'pink-500', category: '특화', description: '국민의 삶을 풍요롭게 하는 문화를 만듭니다.', activity: '국가(國歌) 제작, 국립 박물관/미술관 기획', career: '예술가, 큐레이터, 콘텐츠 제작자' },
            { id: 'foreign_affairs', name: '외교부', icon: '🌐', color: 'indigo-500', category: '특화', description: '다른 국가(학급)와 우호적인 관계를 맺습니다.', activity: '모의 UN 총회 준비, 국가간 교류 협정 체결', career: '외교관, 국제기구 종사자' },
            { id: 'environment_energy', name: '환경에너지부', icon: '🌳', color: 'green-600', category: '특화', description: '자연과 공존하며 지속가능한 발전을 이룹니다.', activity: '친환경 에너지 정책 수립, 국립공원 지정', career: '환경공학자, 에너지 전문가' },
            { id: 'land_transport', name: '국토교통부', icon: '🏙️', color: 'gray-600', category: '특화', description: '살기 좋은 도시와 편리한 교통망을 구축합니다.', activity: '미래 도시 설계, 스마트 교통 시스템 구상', career: '도시계획가, 건축가, 교통공학자' },
            { id: 'sme_ventures', name: '중소벤처기업부', icon: '💡', color: 'cyan-500', category: '특화', description: '창의적인 아이디어가 비즈니스가 되도록 지원합니다.', activity: '스타트업 지원 정책 구상, 창업 경진대회 기획', career: 'CEO, 벤처 투자자, 경영 컨설턴트' },
            { id: 'public_relations', name: '홍보처', icon: '📢', color: 'orange-500', category: '특화', description: '우리 국가의 매력을 널리 알리는 역할을 합니다.', activity: '국가 홍보 영상/포스터 제작, 국정 브리핑', career: '언론인, 아나운서, 광고 전문가' }
        ];
        
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "...", authDomain: "...", projectId: "..." };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-brave-new-world-app';
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        async function setupApp() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Authentication failed:", error);
            }

            const grid = document.getElementById('department-grid');
            const collectionPath = `/artifacts/${appId}/public/data/departments`;

            departments.forEach(dept => {
                const docRef = doc(db, collectionPath, dept.id);

                // Create card HTML
                const card = document.createElement('div');
                card.className = `department-card bg-white rounded-xl shadow-md p-6 border-t-4 border-${dept.color}`;
                card.innerHTML = `
                    <div class="card-content">
                        <div class="text-5xl mb-4">${dept.icon}</div>
                        <h3 class="text-2xl font-bold mb-2">${dept.name}</h3>
                        <p class="text-gray-600 mb-4 text-sm">${dept.description}</p>
                        <div class="text-sm space-y-2 mb-4">
                            <p><strong class="text-gray-700">주요 활동:</strong> ${dept.activity}</p>
                            ${dept.category === '핵심' ? `<p><strong class="text-gray-700">연결점:</strong> ${dept.connection}</p>` : ''}
                            ${dept.category === '특화' ? `<p><strong class="text-gray-700">관련 진로:</strong> ${dept.career}</p>` : ''}
                        </div>
                        ${dept.tags ? `<div class="text-xs mb-4">${dept.tags.map(tag => `<span class="bg-gray-200 rounded-full px-3 py-1 font-semibold mr-1">${tag}</span>`).join('')}</div>` : ''}
                    </div>
                    <div class="mt-auto">
                        <div class="bg-gray-50 p-3 rounded-lg mt-4">
                            <h4 class="font-bold text-sm mb-2">가입한 학생 명단</h4>
                            <ul id="members-${dept.id}" class="member-list text-sm text-gray-700 space-y-1">
                                <li class="text-gray-400">아직 가입한 학생이 없습니다.</li>
                            </ul>
                        </div>
                        <form id="form-${dept.id}" class="mt-4 flex gap-2">
                            <input type="text" placeholder="이름 입력" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-${dept.color}" required>
                            <button type="submit" class="bg-${dept.color} text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-90 transition">가입하기</button>
                        </form>
                    </div>
                `;
                grid.appendChild(card);
                
                // Firestore listener
                onSnapshot(docRef, (docSnap) => {
                    const memberListEl = document.getElementById(`members-${dept.id}`);
                    memberListEl.innerHTML = '';
                    if (docSnap.exists() && docSnap.data().members && docSnap.data().members.length > 0) {
                        docSnap.data().members.forEach(member => {
                            const li = document.createElement('li');
                            li.textContent = member;
                            li.className = "bg-white px-2 py-1 rounded shadow-sm";
                            memberListEl.appendChild(li);
                        });
                    } else {
                        memberListEl.innerHTML = '<li class="text-gray-400">아직 가입한 학생이 없습니다.</li>';
                    }
                });

                // Form submission
                const form = document.getElementById(`form-${dept.id}`);
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const input = form.querySelector('input');
                    const studentName = input.value.trim();
                    if (studentName) {
                        try {
                            const docSnap = await getDoc(docRef);
                            if (!docSnap.exists()) {
                                await setDoc(docRef, { members: [studentName] });
                            } else {
                                await updateDoc(docRef, {
                                    members: arrayUnion(studentName)
                                });
                            }
                            input.value = '';
                        } catch (error) {
                            console.error("Error adding student: ", error);
                            alert("가입 중 오류가 발생했습니다. 다시 시도해주세요.");
                        }
                    }
                });
            });
        }

        setupApp();
    </script>
</body>
</html>

